{% include 'imports.html' %}

<body>
    <div class="uk-text-bold uk-text-large uk-text-center uk-margin-top">
        <h1>Percy's</h1>
    </div>
    <div class="uk-divide-icon" style="height: 1.5px;background-color: #000;"></div>

    <form class="uk-form-stacked uk-width-1-3 uk-align-center" id="authForm">
        <div class="uk-margin">
            <input class="uk-input" type="text" id="emailorpassword" placeholder="Username or Email">
        </div>
        <div class="uk-margin">
            <input class="uk-input" type="password" id="password" placeholder="Password">
        </div>
        <div class="uk-margin">
            <select class="uk-select">
                <option id="admin">Admin</option>
                <option id="user">User</option>
            </select>
        </div>
        <div class="uk-margin">
            <a id="signup" class="uk-link-text uk-text-bold uk-text-bold"
                style="border: none; background-color: #fff;cursor: pointer;border-bottom: 2px solid #0077b6;font-family: Comfortaa;color: #0077b6;">Create
                Account</a>
        </div>
        <div class="uk-margin">
            <button id="authBtn" class="uk-button uk-text-bold uk-button-primary uk-width-1-1">Login To Your
                Account</button>
        </div>
    </form>

    <script>
        document.getElementById("signup").addEventListener("click", function () {
            window.location.href = "/auth/register";
        })

        document.getElementById("authBtn").addEventListener("click", function (e) {
            e.preventDefault();

            const emailOrPassword = document.getElementById("emailorpassword").value;
            const password = document.getElementById("password").value;

            fetch("/api/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    email: emailOrPassword,
                    username: emailOrPassword,
                    password: password
                }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.message === "logged in successfully") {
                        if (data.is_admin === true) {
                            Cookies.set('admin_access_token', data.access_token, { expiry: 0.2 })
                            Cookies.set('admin_refresh_token', data.refresh_token, { expiry: 0.2 })
                            window.location.href = "/admin/dashboard";
                        } else {
                            Cookies.set('user_access_token', data.access_token, { expiry: 0.2 })
                            Cookies.set('user_refresh_token', data.refresh_token, { expiry: 0.2 })
                            window.location.href = "/dashboard";
                        }
                    } else {
                        alert("Login failed: " + data.message);
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("An error occurred during login");
                });
        });

    </script>
</body>